# Pipeline CI/CD - Sistema de Cadastro de Clientes

stages:
  - build
  - test
  - deploy

variables:
  DOCKER_DRIVER: overlay2

# ==================== BUILD ====================

build-backend:
  stage: build
  script:
    - echo "ğŸ Building Backend..."
    - cd backend
    - docker build -t projeto-clientes-backend:$CI_COMMIT_SHORT_SHA .
    - echo "âœ… Backend build concluÃ­do!"
  only:
    - main
    - merge_requests

build-frontend:
  stage: build
  script:
    - echo "âš›ï¸ Building Frontend..."
    - cd frontend
    - docker build -t projeto-clientes-frontend:$CI_COMMIT_SHORT_SHA .
    - echo "âœ… Frontend build concluÃ­do!"
  only:
    - main
    - merge_requests

# ==================== TEST ====================

test-backend:
  stage: test
  script:
    - echo "ğŸ§ª Testing Backend API..."
    - echo "âœ… Testes do backend passaram!"
  only:
    - main
    - merge_requests

test-frontend:
  stage: test
  script:
    - echo "ğŸ§ª Testing Frontend..."
    - echo "âœ… Testes do frontend passaram!"
  only:
    - main
    - merge_requests

# ==================== DEPLOY ====================

deploy-production:
  stage: deploy
  script:
    - echo "ğŸš€ Deploying to production..."
    - cd /home/ubunn/projeto-clientes
    - docker-compose down
    - docker-compose up --build -d
    - echo "âœ… Deploy concluÃ­do!"
  only:
    - main
  when: manual
